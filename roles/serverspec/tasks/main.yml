#####
#
# serverspec/tasks/main.yml
#
#####

---
- name: Install ruby
  shell: rbenv install -v 2.6.4
  ignore_errors: true

- name: set ruby version for global
  shell: rbenv global 2.6.4
  ignore_errors: true

- name: install serverspec
  gem:
    name: "{{ item }}"
    state: present
  with_items:
    - rake
    - serverspec

- name: serverspec init configs
  copy:
    src: ../files/
    dest: /home/centos/
    owner: centos
    group: centos
    mode: '0644'

- name: set spec file
  template:
    src: web_spec.rb.j2
    dest: /home/centos/spec/localhost/web_spec.rb
    owner: centos
    group: centos
    mode: '0644'
